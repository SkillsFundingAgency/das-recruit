@using Microsoft.AspNetCore.Mvc.ModelBinding;
@model ValidationSummaryViewModel
@{ 
    var validationSummaryClass = Model.ModelState.IsValid ? "validation-summary-valid" : "validation-summary-errors";
}
<div class="@validationSummaryClass govuk-error-summary" role="alert" data-valmsg-summary="true" tabindex="-1">
    <h2 id="govuk-error-summary__title" class="heading-medium error-summary-heading">
        Please fix these errors
    </h2>
    <div class="govuk-error-summary__body">
        <ul class="govuk-error-summary__list">
            @foreach (var stateItem in Model.ModelState.Where(msi => msi.Value.ValidationState == ModelValidationState.Invalid)
                                                        .OrderBy(x => Model.OrderedFieldNames.IndexOf(x.Key)))
            {
                var elementName = ViewData.TemplateInfo.GetFullHtmlFieldName(stateItem.Key) ?? stateItem.Key;
                var firstErrorPerField = stateItem.Value.Errors.FirstOrDefault()?.ErrorMessage;
            <li>
                @if (!string.IsNullOrEmpty(stateItem.Key))
                {
                <a href="#error-message-@elementName" data-focuses="error-message-@elementName" class="summary-link">@firstErrorPerField</a>
                }
                else
                {
                <span>@firstErrorPerField</span>
                }
            </li>
            }
        </ul>
    </div>
</div>